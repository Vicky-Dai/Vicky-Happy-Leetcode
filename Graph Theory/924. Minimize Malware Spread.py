class Solution:
    def minMalwareSpread(self, graph, initial):
        n = len(graph)
        initial.sort()

        # infect_by[x] = 所有能感染节点 x 的 initial 下标集合
        infect_by = [set() for _ in range(n)]

        # 对每个初始感染源 i 做 BFS
        for src in initial:
            visited = set([src])
            queue = collections.deque([src])

            while queue:
                node = queue.popleft()
                infect_by[node].add(src)
                for nei in range(n):
                    if graph[node][nei] == 1 and nei not in visited:
                        visited.add(nei)
                        queue.append(nei)

        # benefit[i] = 删除 i 后能阻止的独占感染节点数
        benefit = {i: 0 for i in initial}

        for node in range(n):
            if len(infect_by[node]) == 1:
                src = next(iter(infect_by[node]))
                benefit[src] += 1

        # 返回 benefit 最大，若平手选编号最小
        best = initial[0]
        best_val = -1

        for i in initial:
            if benefit[i] > best_val:
                best_val = benefit[i]
                best = i

        return best
